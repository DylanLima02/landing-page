<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Planejador Diário</title>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: Arial, Helvetica, sans-serif;
      background: #f6f8fc;
      color: #202124;
    }

    :root {
      --hour-height: 60px; /* 60min */
    }

    .app {
      display: grid;
      grid-template-columns: 260px 1fr;
      height: 100vh;
    }

    .sidebar {
      background: #fff;
      border-right: 1px solid #e0e0e0;
      padding: 16px;
    }

    .btn-create {
      width: 100%;
      padding: 10px;
      border-radius: 24px;
      border: none;
      background: #1a73e8;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      margin-bottom: 20px;
    }

    .content {
      display: flex;
      flex-direction: column;
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 20px;
      border-bottom: 1px solid #e0e0e0;
      background: #fff;
    }

    .agenda {
      flex: 1;
      overflow-y: auto;
      background: #fff;
      position: relative;
    }

    .time-grid {
      display: grid;
      grid-template-columns: 80px 1fr;
    }

    .hour-label {
      height: var(--hour-height);
      border-bottom: 1px solid #e0e0e0;
      padding: 6px;
      font-size: 12px;
      text-align: right;
      color: #5f6368;
    }

    .grid {
      position: relative;
      border-bottom: 1px solid #e0e0e0;
      height: calc(24 * var(--hour-height));
    }

    .line {
      position: absolute;
      left: 0;
      right: 0;
      height: 1px;
      background: #eee;
    }

    .event {
      position: absolute;
      left: 8px;
      right: 8px;
      background: #1a73e8;
      color: #fff;
      border-radius: 6px;
      padding: 6px;
      font-size: 12px;
      cursor: grab;
    }

    .event small { opacity: 0.8; }

    .resize {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 6px;
      cursor: ns-resize;
      background: rgba(255,255,255,.3);
    }
  </style>
</head>
<body>
<div class="app">

  <aside class="sidebar">
    <button class="btn-create" id="createBtn">+ Criar evento</button>
    <p><strong>Visões:</strong></p>
    <p>• Dia (ativo)</p>
    <p>• Semana (em breve)</p>
    <p>• Mês (em breve)</p>
  </aside>

  <main class="content">
    <div class="header">
      <div id="currentDate"></div>
      <div>
        <button id="prevDay">◀</button>
        <button id="today">Hoje</button>
        <button id="nextDay">▶</button>
      </div>
    </div>

    <div class="agenda">
      <div class="time-grid">
        <div id="hours"></div>
        <div class="grid" id="grid"></div>
      </div>
    </div>
  </main>
</div>

<script>
/* ================= ESTADO ================= */
let state = {
  date: new Date(),
  events: JSON.parse(localStorage.getItem('events') || '[]')
};

/* ================= UTIL ================= */
const pad = n => n.toString().padStart(2, '0');
const formatDate = d => `${pad(d.getDate())}/${pad(d.getMonth()+1)}/${d.getFullYear()}`;
const minutesFromTime = t => {
  const [h,m] = t.split(':').map(Number);
  return h*60 + m;
};

/* ================= RENDER ================= */
const hoursEl = document.getElementById('hours');
const gridEl = document.getElementById('grid');
const dateEl = document.getElementById('currentDate');

function renderHours() {
  hoursEl.innerHTML = '';
  for (let h = 0; h < 24; h++) {
    const div = document.createElement('div');
    div.className = 'hour-label';
    div.textContent = `${pad(h)}:00`;
    hoursEl.appendChild(div);
  }
}

function renderGridLines() {
  gridEl.innerHTML = '';
  for (let i = 0; i < 24 * 4; i++) {
    const line = document.createElement('div');
    line.className = 'line';
    line.style.top = `${i * 15}px`;
    gridEl.appendChild(line);
  }
}

function renderEvents() {
  state.events
    .filter(e => e.date === state.date.toISOString().slice(0,10))
    .forEach(e => {
      const div = document.createElement('div');
      const start = minutesFromTime(e.start);
      const end = minutesFromTime(e.end);

      div.className = 'event';
      div.style.top = `${start}px`;
      div.style.height = `${end - start}px`;
      div.style.background = e.color;
      div.innerHTML = `<strong>${e.title}</strong><br><small>${e.start} - ${e.end}</small><div class="resize"></div>`;

      enableDrag(div, e);
      enableResize(div, e);

      gridEl.appendChild(div);
    });
}

function render() {
  dateEl.textContent = formatDate(state.date);
  renderHours();
  renderGridLines();
  renderEvents();
}

/* ================= EVENTOS ================= */
function createEvent() {
  const title = prompt('Título do evento');
  if (!title) return;

  const start = prompt('Hora início (HH:MM)', '09:00');
  const end = prompt('Hora fim (HH:MM)', '10:00');

  state.events.push({
    id: Date.now(),
    title,
    date: state.date.toISOString().slice(0,10),
    start,
    end,
    color: '#1a73e8'
  });

  save();
  render();
}

function save() {
  localStorage.setItem('events', JSON.stringify(state.events));
}

/* ================= DRAG ================= */
function enableDrag(el, event) {
  let startY;
  el.onmousedown = e => {
    if (e.target.classList.contains('resize')) return;
    startY = e.clientY;
    document.onmousemove = ev => {
      const delta = ev.clientY - startY;
      const minutes = Math.round(delta / 15) * 15;
      const newStart = minutesFromTime(event.start) + minutes;
      const duration = minutesFromTime(event.end) - minutesFromTime(event.start);

      if (newStart >= 0) {
        event.start = `${pad(Math.floor(newStart/60))}:${pad(newStart%60)}`;
        event.end = `${pad(Math.floor((newStart+duration)/60))}:${pad((newStart+duration)%60)}`;
        render();
      }
    };
    document.onmouseup = () => { document.onmousemove = null; save(); };
  };
}

/* ================= RESIZE ================= */
function enableResize(el, event) {
  const handle = el.querySelector('.resize');
  handle.onmousedown = e => {
    e.stopPropagation();
    const startY = e.clientY;
    document.onmousemove = ev => {
      const delta = ev.clientY - startY;
      const minutes = Math.round(delta / 15) * 15;
      const newEnd = minutesFromTime(event.end) + minutes;
      if (newEnd > minutesFromTime(event.start)) {
        event.end = `${pad(Math.floor(newEnd/60))}:${pad(newEnd%60)}`;
        render();
      }
    };
    document.onmouseup = () => { document.onmousemove = null; save(); };
  };
}

/* ================= CONTROLES ================= */
document.getElementById('createBtn').onclick = createEvent;
document.getElementById('today').onclick = () => { state.date = new Date(); render(); };
document.getElementById('prevDay').onclick = () => { state.date.setDate(state.date.getDate()-1); render(); };
document.getElementById('nextDay').onclick = () => { state.date.setDate(state.date.getDate()+1); render(); };

render();
</script>
</body>
</html>
